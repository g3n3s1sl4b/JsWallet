name: e2e-tests
on:
  pull_request:
    # branches: [testnet]
# concurrency:
#   group: e2e-tests-${{github.event.pull_request.number}}
#   cancel-in-progress: true
jobs:
  e2e-tests:
    # runs-on: ubuntu-latest
    runs-on: macos-internal2
    defaults:
      run:
        working-directory: ./e2e
    steps:
      - name: setup web3t
        working-directory: ./
        run: cd .. && cd web3t && git pull && npm i
      - uses: actions/checkout@v2
      - name: mkdir for web3t
        working-directory: ./
        run: mkdir -p .compiled-ssr/web3t/
      - name: copy web3t
        working-directory: ../
        run: cp -pr web3t/ JsWallet/.compiled-ssr/web3t/
      - name: run wallet
        working-directory: ./
        run: |
          npm run wallet-start &
          sleep 13 &&
          echo '- - - - - Wallet started - - - - -'
      - name: install modules required for testrun
        run: npm ci
      - name: run tests
        run: npm test

      # RUN IN DOCKER
      # - name: prepare
      #   run: docker build -t wallet-tests .
      # - name: run tests
      #   run: docker run wallet-tests /bin/bash -c "npm test"
